# æ‘„å½±åœ°ç‚¹åˆ†äº«åç«¯æœåŠ¡

ä¸€ä¸ªåŸºäºSpring Bootçš„æ‘„å½±åœ°ç‚¹åˆ†äº«å¹³å°åç«¯æœåŠ¡ï¼Œæ”¯æŒç”¨æˆ·æ³¨å†Œç™»å½•ã€åšæ–‡ç®¡ç†ã€å›¾ç‰‡ä¸Šä¼ ç­‰åŠŸèƒ½ã€‚

## ğŸ“‹ ç›®å½•

- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ¥å£æ–‡æ¡£](#æ¥å£æ–‡æ¡£)
- [æ ¸å¿ƒåŠŸèƒ½å®ç°](#æ ¸å¿ƒåŠŸèƒ½å®ç°)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)

## ğŸ›  æŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶
- **Spring Boot 3.4.9** - ä¸»æ¡†æ¶
- **Spring Web** - Webå¼€å‘
- **Spring AOP** - é¢å‘åˆ‡é¢ç¼–ç¨‹
- **Spring Security** - å®‰å…¨æ¡†æ¶ï¼ˆå¯é€‰ï¼‰

### æ•°æ®æŒä¹…åŒ–
- **MyBatis-Plus 3.5.7** - ORMæ¡†æ¶
- **MySQL 8.0+** - å…³ç³»å‹æ•°æ®åº“
- **HikariCP** - æ•°æ®åº“è¿æ¥æ± 

### ç¼“å­˜ä¸æ¶ˆæ¯
- **Redis** - ç¼“å­˜æ•°æ®åº“
- **RabbitMQ** - æ¶ˆæ¯é˜Ÿåˆ—
- **Elasticsearch** - å…¨æ–‡æœç´¢å¼•æ“

### å®‰å…¨è®¤è¯
- **JWT (JSON Web Token)** - èº«ä»½è®¤è¯
- **MD5** - å¯†ç åŠ å¯†ï¼ˆæ”¯æŒBCryptå‡çº§ï¼‰

### æ–‡ä»¶å­˜å‚¨
- **MinIO** - å¯¹è±¡å­˜å‚¨æœåŠ¡
- **é˜¿é‡Œäº‘OSS** - äº‘å­˜å‚¨ï¼ˆå¯é€‰ï¼‰

### å·¥å…·åº“
- **Lombok** - ç®€åŒ–ä»£ç 
- **Hutool** - Javaå·¥å…·ç±»åº“
- **Knife4j** - APIæ–‡æ¡£ç”Ÿæˆ
- **Apache Commons** - é€šç”¨å·¥å…·åº“

### å…¶ä»–æœåŠ¡
- **Spring Mail** - é‚®ä»¶å‘é€
- **Quartz** - å®šæ—¶ä»»åŠ¡è°ƒåº¦
- **Thymeleaf** - æ¨¡æ¿å¼•æ“

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ” ç”¨æˆ·ç®¡ç†
- ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- JWT Tokenè®¤è¯
- å¯†ç åŠ å¯†å­˜å‚¨
- ç”¨æˆ·ä¿¡æ¯ç®¡ç†

### ğŸ“ åšæ–‡ç®¡ç†
- æ‘„å½±åœ°ç‚¹åšæ–‡å‘å¸ƒ
- åœ°ç†ä½ç½®å®šä½
- å›¾ç‰‡æ‰¹é‡ä¸Šä¼ 
- åšæ–‡åˆ†ç±»ç®¡ç†
- åˆ†é¡µæŸ¥è¯¢æ”¯æŒ

### ğŸ–¼ å›¾ç‰‡æœåŠ¡
- å¤šå›¾ç‰‡ä¸Šä¼ 
- å›¾ç‰‡é¡ºåºæ’åº
- MinIOå¯¹è±¡å­˜å‚¨
- å›¾ç‰‡è®¿é—®URLç”Ÿæˆ

### ğŸ” æœç´¢åŠŸèƒ½
- æŒ‰ç±»å‹æœç´¢åšæ–‡
- åœ°ç†ä½ç½®èŒƒå›´æŸ¥è¯¢
- ä½œè€…åšæ–‡æŸ¥è¯¢
- Elasticsearchå…¨æ–‡æœç´¢

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Java 17+
- Maven 3.6+
- MySQL 8.0+
- Redis 6.0+
- MinIOæœåŠ¡

### æ•°æ®åº“é…ç½®
1. åˆ›å»ºæ•°æ®åº“ï¼š
```sql
CREATE DATABASE pd CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. æ‰§è¡ŒSQLè„šæœ¬ï¼š
```bash
mysql -u root -p pd < src/main/resources/sql/create_pd_user_table.sql
mysql -u root -p pd < src/main/resources/sql/create_pd_article_table.sql
```

### é…ç½®æ–‡ä»¶
å¤åˆ¶é…ç½®æ¨¡æ¿å¹¶ä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š
```yaml
# application.yml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/pd?serverTimezone=Asia/Shanghai
    username: your_username
    password: your_password
  redis:
    host: localhost
    port: 6379
    password: your_redis_password
```

### å¯åŠ¨æœåŠ¡
```bash
# ä½¿ç”¨Mavenå¯åŠ¨
./mvnw spring-boot:run

# æˆ–è€…æ‰“åŒ…åå¯åŠ¨
./mvnw clean package
java -jar target/backend-0.0.1-SNAPSHOT.jar
```

æœåŠ¡å¯åŠ¨åè®¿é—®ï¼šhttp://localhost:8080

## ğŸ“š æ¥å£æ–‡æ¡£

### ç”¨æˆ·è®¤è¯æ¥å£

#### ç”¨æˆ·æ³¨å†Œ
```http
POST /api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "password": "test123",
  "nickname": "æµ‹è¯•ç”¨æˆ·",
  "email": "test@example.com",
  "phone": "13800138000"
}
```

#### ç”¨æˆ·ç™»å½•
```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "testuser",
  "password": "test123"
}
```

### åšæ–‡ç®¡ç†æ¥å£

#### åˆ›å»ºåšæ–‡
```http
POST /api/articles/create
Authorization: Bearer <jwt_token>
Content-Type: application/json

{
  "title": "åŒ—äº¬æ•…å®«å»ºç­‘ä¹‹ç¾",
  "name": "æ•…å®«åšç‰©é™¢",
  "latitude": 39.9163447,
  "longitude": 116.3972282,
  "type": "architecture",
  "description": "ç´«ç¦åŸï¼Œæ˜æ¸…ä¸¤æœçš„çš‡å®¶å®«æ®¿",
  "tips": "æ—©æ™¨æˆ–å‚æ™šå…‰çº¿æœ€ä½³",
  "address": "åŒ—äº¬å¸‚ä¸œåŸåŒºæ™¯å±±å‰è¡—4å·",
  "notice": "éœ€è¦æå‰é¢„çº¦",
  "tools": "å•åç›¸æœºï¼Œä¸‰è„šæ¶"
}
```

#### æŸ¥è¯¢åšæ–‡åˆ—è¡¨
```http
GET /api/articles/type/architecture/page?page=1&size=10
```

#### å›¾ç‰‡ä¸Šä¼ 
```http
POST /api/articles/images
Authorization: Bearer <jwt_token>
Content-Type: multipart/form-data

articleId: 123
images: [file1, file2, file3]
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### JWTè®¤è¯å®ç°

#### 1. Tokenç”Ÿæˆ
```java
@Component
public class JwtUtils {
    
    @Value("${jwt.secret}")
    private String jwtSecret;
    
    private final long expiration = TimeUnit.HOURS.toMillis(24);
    
    public String generateToken(String username) {
        return Jwts.builder()
                .claims(claims)
                .expiration(new Date(System.currentTimeMillis() + expiration))
                .signWith(getSigningKey())
                .compact();
    }
}
```

#### 2. æ‹¦æˆªå™¨éªŒè¯
```java
@Component
public class JwtInterceptor implements HandlerInterceptor {
    
    @Override
    public boolean preHandle(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler) throws Exception {
        String token = request.getHeader("Authorization");
        if (token != null && token.startsWith("Bearer ")) {
            token = token.substring(7);
            String username = jwtUtils.getUsernameFromToken(token);
            request.setAttribute("username", username);
        }
        return true;
    }
}
```

#### 3. ç™½åå•é…ç½®
```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(jwtInterceptor)
                .addPathPatterns("/**")
                .excludePathPatterns("/api/auth/login", "/api/auth/register");
    }
}
```

### å¯†ç åŠ å¯†å®ç°

```java
public class PasswordUtils {
    
    public static String encrypt(String password) {
        return DigestUtils.md5DigestAsHex(password.getBytes());
    }
    
    public static boolean matches(String rawPassword, String encryptedPassword) {
        return encrypt(rawPassword).equals(encryptedPassword);
    }
}
```

### æ–‡ä»¶ä¸Šä¼ å®ç°

#### 1. MinIOé…ç½®
```yaml
upload:
  mode: minio
  minio:
    url: http://localhost:9000
    endpoint: http://localhost:9000
    accesskey: minioadmin
    secretKey: minioadmin
    bucketName: photos
```

#### 2. ä¸Šä¼ Service
```java
@Service
public class FileUploadService {
    
    @Value("${upload.minio.endpoint}")
    private String endpoint;
    
    public String uploadFile(MultipartFile file) {
        // MinIOä¸Šä¼ é€»è¾‘
        String fileName = generateFileName(file.getOriginalFilename());
        minioClient.putObject(bucketName, fileName, file.getInputStream());
        return getFileUrl(fileName);
    }
}
```

#### 3. å›¾ç‰‡æ’åºå­˜å‚¨
```java
@Service
public class ArticleImageService {
    
    public void saveArticleImages(Integer articleId, List<MultipartFile> images) {
        for (int i = 0; i < images.size(); i++) {
            String imageUrl = fileUploadService.uploadFile(images.get(i));
            
            ArticleImage articleImage = new ArticleImage();
            articleImage.setArticleId(articleId);
            articleImage.setImageUrl(imageUrl);
            articleImage.setOrderIndex(i + 1); // è®¾ç½®æ’åºç´¢å¼•
            
            articleImageMapper.insert(articleImage);
        }
    }
}
```

## ğŸ—„ æ•°æ®åº“è®¾è®¡

### ç”¨æˆ·è¡¨ (pd_user)
```sql
CREATE TABLE `pd_user` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `username` varchar(50) NOT NULL COMMENT 'ç”¨æˆ·å',
  `password` varchar(100) NOT NULL COMMENT 'å¯†ç ',
  `nickname` varchar(50) DEFAULT NULL COMMENT 'æ˜µç§°',
  `email` varchar(100) DEFAULT NULL COMMENT 'é‚®ç®±',
  `phone` varchar(20) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
  `create_time` datetime DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`)
);
```

### åšæ–‡è¡¨ (pd_article)
```sql
CREATE TABLE `pd_article` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `title` VARCHAR(255) NOT NULL COMMENT 'åšæ–‡æ ‡é¢˜',
  `name` VARCHAR(100) NOT NULL COMMENT 'åœ°ç‚¹åç§°',
  `latitude` DECIMAL(10,7) NOT NULL COMMENT 'çº¬åº¦',
  `longitude` DECIMAL(10,7) NOT NULL COMMENT 'ç»åº¦',
  `type` VARCHAR(50) NOT NULL COMMENT 'ç±»å‹',
  `description` TEXT COMMENT 'åœ°ç‚¹æè¿°',
  `tips` TEXT COMMENT 'æ‘„å½±æç¤º',
  `author_id` VARCHAR(50) COMMENT 'ä½œè€…ID',
  `address` VARCHAR(255) COMMENT 'è¯¦ç»†åœ°å€',
  `notice` TEXT COMMENT 'æ³¨æ„äº‹é¡¹',
  `tools` TEXT COMMENT 'æ¨èå™¨æ',
  `create_time` DATETIME NOT NULL,
  `update_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### å›¾ç‰‡è¡¨ (pd_article_image)
```sql
CREATE TABLE `pd_article_image` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `article_id` INT NOT NULL COMMENT 'åšæ–‡ID',
  `image_url` VARCHAR(500) NOT NULL COMMENT 'å›¾ç‰‡URL',
  `order_index` INT NOT NULL COMMENT 'æ’åºç´¢å¼•',
  INDEX `idx_article_id` (`article_id`)
);
```

## âš™ï¸ é…ç½®è¯´æ˜

### æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
```yaml
spring:
  datasource:
    hikari:
      minimum-idle: 2
      idle-timeout: 120000
      maximum-pool-size: 8
      max-lifetime: 240000
      connection-timeout: 10000
      keepalive-time: 60000
```

### Redisç¼“å­˜é…ç½®
```yaml
spring:
  redis:
    host: localhost
    port: 6379
    database: 0
    lettuce:
      pool:
        max-active: 100
        max-idle: 100
        min-idle: 10
```

### JWTå®‰å…¨é…ç½®
```yaml
jwt:
  secret: pdJWTSecretKey2025ForSpringBootBackendProject
  # å¯†é’¥é•¿åº¦è‡³å°‘32å­—ç¬¦ï¼Œç¡®ä¿å®‰å…¨æ€§
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Dockeréƒ¨ç½²
```dockerfile
FROM openjdk:17-jre-slim

COPY target/backend-0.0.1-SNAPSHOT.jar app.jar

EXPOSE 8080

ENTRYPOINT ["java", "-jar", "/app.jar"]
```

### Docker Compose
```yaml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "8080:8080"
    depends_on:
      - mysql
      - redis
      - minio
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://mysql:3306/pd
      - SPRING_REDIS_HOST=redis
      - UPLOAD_MINIO_ENDPOINT=http://minio:9000

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: pd
    ports:
      - "3306:3306"

  redis:
    image: redis:6.2
    ports:
      - "6379:6379"

  minio:
    image: minio/minio
    command: server /data --console-address ":9001"
    ports:
      - "9000:9000"
      - "9001:9001"
```

## ğŸ“– å¼€å‘è§„èŒƒ

### ä»£ç è§„èŒƒ
- ä½¿ç”¨Lombokç®€åŒ–ä»£ç 
- ç»Ÿä¸€å¼‚å¸¸å¤„ç†
- JWTæ‹¦æˆªå™¨ç»Ÿä¸€è®¤è¯
- å¯†ç åŠ å¯†å­˜å‚¨

### å®‰å…¨è§„èŒƒ
- æ•æ„Ÿæ¥å£éœ€è¦JWTè®¤è¯
- å¯†ç ä½¿ç”¨MD5åŠ å¯†ï¼ˆå»ºè®®å‡çº§BCryptï¼‰
- è¾“å…¥å‚æ•°éªŒè¯
- SQLæ³¨å…¥é˜²æŠ¤

### æ€§èƒ½ä¼˜åŒ–
- æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- Redisç¼“å­˜ç­–ç•¥
- åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–